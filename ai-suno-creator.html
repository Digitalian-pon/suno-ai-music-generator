<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎵 AI Suno Creator Studio</title>
    <meta name="theme-color" content="#667eea">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .api-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .api-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .generate-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .big-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 10px;
        }
        
        .big-btn:hover:not(:disabled) {
            transform: translateY(-3px);
        }
        
        .big-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }
        
        .result-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }
        
        .result-content {
            background: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .midjourney-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #666;
        }
        
        .control-group select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .theme-display {
            background: #e9ecef;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .theme-text {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
        }
        
        .saved-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .saved-indicator.show {
            opacity: 1;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .api-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .api-option {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .api-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 2em; }
            .main-panel { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎵 AI Suno Creator Studio</h1>
            <p class="subtitle">AI生成による無限バリエーション楽曲コンテンツ</p>
        </header>
        
        <div class="main-panel">
            <div class="api-setup">
                <h3>🔧 AI設定</h3>
                <div class="api-selector">
                    <div class="api-option selected" onclick="selectAPI('local')">
                        🏠 ローカルAI (オフライン)
                    </div>
                    <div class="api-option" onclick="selectAPI('openai')">
                        🤖 OpenAI (要API Key)
                    </div>
                    <div class="api-option" onclick="selectAPI('claude')">
                        🧠 Claude (要API Key)
                    </div>
                    <div class="api-option" onclick="selectAPI('gemini')">
                        ✨ Gemini (要API Key)
                    </div>
                </div>
                <div id="apiKeySection" style="display: none;">
                    <input type="password" id="apiKey" class="api-input" placeholder="API Keyを入力してください">
                    <small style="color: #666;">API KeyはブラウザのlocalStorageに安全に保存されます</small>
                </div>
            </div>
            
            <div class="generate-section">
                <button class="big-btn" onclick="generateAll()" id="generateBtn">🎲 AI楽曲生成</button>
            </div>
            
            <div class="theme-display" id="themeDisplay">
                <div class="theme-text" id="themeText">🎯 AIがユニークなテーマを生成します</div>
            </div>
            
            <div class="results-grid" id="resultsGrid">
                <!-- 結果がここに表示されます -->
            </div>
        </div>
    </div>
    
    <div class="saved-indicator" id="savedIndicator">💾 自動保存されました</div>

    <script>
        let selectedAPI = 'local';
        let currentGeneration = null;
        
        // テーマ・コンセプトのベースデータ
        const themeElements = {
            concepts: [
                "時をかける恋", "AI少女との恋", "異世界での失恋", "ワープした先の君",
                "デジタル世界の片想い", "ループする告白", "AIが歌う失恋歌", "異次元恋愛事情",
                "サイバー空間の初恋", "時間停止中の恋", "ホログラムの恋人", "記憶を消された恋",
                "量子もつれの愛", "バーチャル結婚式", "ネオンライトの下で", "メタバースの秘密",
                "タイムパラドックス恋愛", "AIアシスタントへの想い", "異世界転生後の再会", "未来からの手紙"
            ],
            emotions: [
                "切ない", "希望に満ちた", "ノスタルジックな", "情熱的な", "神秘的な",
                "メランコリックな", "エキサイティングな", "ドリーミーな", "エモーショナルな", "ロマンチックな"
            ],
            settings: [
                "ネオン街", "サイバー空間", "未来都市", "異世界", "宇宙ステーション",
                "デジタル図書館", "バーチャルカフェ", "時空の狭間", "AI研究所", "量子コンピューター内部"
            ],
            keywords: [
                "タイムリープ", "人工知能", "ファンタジー", "時空", "メタバース",
                "ホログラム", "バーチャル", "サイバーパンク", "未来", "異次元"
            ]
        };
        
        // API選択
        function selectAPI(apiType) {
            selectedAPI = apiType;
            document.querySelectorAll('.api-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            const apiKeySection = document.getElementById('apiKeySection');
            if (apiType === 'local') {
                apiKeySection.style.display = 'none';
            } else {
                apiKeySection.style.display = 'block';
                // 保存されたAPI Keyを読み込み
                const savedKey = localStorage.getItem(`${apiType}_api_key`);
                if (savedKey) {
                    document.getElementById('apiKey').value = savedKey;
                }
            }
        }
        
        // ランダムテーマ生成（AI風）
        function generateRandomTheme() {
            const concept = themeElements.concepts[Math.floor(Math.random() * themeElements.concepts.length)];
            const emotion = themeElements.emotions[Math.floor(Math.random() * themeElements.emotions.length)];
            const setting = themeElements.settings[Math.floor(Math.random() * themeElements.settings.length)];
            const keyword1 = themeElements.keywords[Math.floor(Math.random() * themeElements.keywords.length)];
            const keyword2 = themeElements.keywords[Math.floor(Math.random() * themeElements.keywords.length)];
            
            // ユニークな組み合わせを生成
            const variations = [
                `${emotion}${concept}`,
                `${setting}での${concept}`,
                `${keyword1}と${keyword2}の${concept}`,
                `${emotion}${setting}の${concept}`,
                `${concept} - ${keyword1}編`
            ];
            
            const finalConcept = variations[Math.floor(Math.random() * variations.length)];
            const keywords = `${keyword1}, ${keyword2}, ${emotion}, ${setting}`;
            
            return { concept: finalConcept, keywords: keywords };
        }
        
        // メイン生成関数
        async function generateAll() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '🤖 AI生成中...';
            
            try {
                const theme = generateRandomTheme();
                document.getElementById('themeText').textContent = `🎯 ${theme.concept} (${theme.keywords})`;
                
                const resultsGrid = document.getElementById('resultsGrid');
                resultsGrid.innerHTML = '<div class="loading full-width"><div class="spinner"></div>AIが楽曲コンテンツを生成中...</div>';
                
                let generation;
                
                // 常にローカル生成を優先（エラー回避）
                if (selectedAPI === 'local') {
                    generation = await generateLocalContent(theme);
                } else {
                    // 外部APIが選択されている場合
                    const apiKey = document.getElementById('apiKey').value;
                    if (!apiKey || apiKey.trim() === '') {
                        // API Keyが未入力の場合はローカルモードにフォールバック
                        console.log('API Key未入力のためローカルモードで生成します');
                        generation = await generateLocalContent(theme);
                        showMessage('API Key未入力のため、ローカルAIで生成しました', 'warning');
                    } else {
                        try {
                            // API Key保存
                            localStorage.setItem(`${selectedAPI}_api_key`, apiKey);
                            generation = await generateAIContent(theme);
                        } catch (apiError) {
                            console.log('API接続失敗、ローカルモードにフォールバック:', apiError);
                            generation = await generateLocalContent(theme);
                            showMessage('API接続に失敗したため、ローカルAIで生成しました', 'warning');
                        }
                    }
                }
                
                currentGeneration = {
                    ...generation,
                    theme: theme,
                    timestamp: new Date().toLocaleString('ja-JP')
                };
                
                displayResults(currentGeneration);
                saveToHistory(currentGeneration);
                showSavedIndicator();
                
            } catch (error) {
                console.error('致命的エラー:', error);
                // 最後の手段としてローカル生成
                try {
                    const theme = generateRandomTheme();
                    const generation = await generateLocalContent(theme);
                    currentGeneration = {
                        ...generation,
                        theme: theme,
                        timestamp: new Date().toLocaleString('ja-JP')
                    };
                    displayResults(currentGeneration);
                    showMessage('エラーが発生しましたが、ローカルAIで生成しました', 'warning');
                } catch (fallbackError) {
                    document.getElementById('resultsGrid').innerHTML = `
                        <div class="error full-width">
                            ❌ 生成エラー: ${error.message}<br>
                            ページを再読み込みして再試行してください。
                        </div>
                    `;
                }
            } finally {
                btn.disabled = false;
                btn.textContent = '🎲 AI楽曲生成';
            }
        }
        
        // ローカルAI生成（高度なアルゴリズム）
        async function generateLocalContent(theme) {
            // シミュレート遅延
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            try {
                return {
                    title: generateAdvancedTitle(theme),
                    lyricsJP: generateAdvancedJapaneseLyrics(theme),
                    lyricsEN: generateAdvancedEnglishLyrics(theme),
                    stylePrompt: generateAdvancedStylePrompt(theme),
                    midjourneyPrompt: generateAdvancedMidjourneyPrompt(theme),
                    aspectRatio: "1:1",
                    model: "v7"
                };
            } catch (error) {
                console.error('ローカル生成エラー:', error);
                // フォールバック用の基本生成
                return {
                    title: `${theme.concept} - AI Generated`,
                    lyricsJP: `[Verse 1]\n${theme.concept}の物語\n心に響く想いを込めて\nデジタルな世界で\n君を探し続ける\n\n[Chorus]\n${theme.concept}が始まる\n新しい未来へと\n歩いていこう\n愛を胸に抱いて`,
                    lyricsEN: `[Verse 1]\nIn this digital world tonight\nSearching for that special light\n${theme.concept} calling out to me\nIn this virtual reality\n\n[Chorus]\n${theme.concept} begins today\nIn this cyber world we'll stay\nLove transcends the digital divide\nWith you right here by my side`,
                    stylePrompt: `Style: Electronic Pop\nMood: Emotional and uplifting\nTempo: 120 BPM\nTheme: ${theme.concept}`,
                    midjourneyPrompt: `${theme.concept}, digital art, cyberpunk aesthetic, emotional atmosphere, high quality`,
                    aspectRatio: "1:1",
                    model: "v7"
                };
            }
        }
        
        // 実際のAI API呼び出し
        async function generateAIContent(theme) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                throw new Error('API Keyが必要です');
            }
            
            const prompts = {
                title: `Create a catchy, unique song title for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Make it viral-worthy and memorable.`,
                lyricsJP: `Create Japanese lyrics for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Include verse, chorus, bridge structure. Make it catchy and emotionally engaging.`,
                lyricsEN: `Create English lyrics for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Include verse, chorus, bridge structure. Make it catchy, unique, and perfect for going viral.`,
                stylePrompt: `Create a detailed Suno AI style prompt for a song about "${theme.concept}". Include tempo, instruments, mood, production notes, and specific musical elements.`,
                midjourneyPrompt: `Create a Midjourney prompt for an image that represents a song about "${theme.concept}". Make it visually striking, emotionally resonant, and perfect for album art.`
            };
            
            const results = {};
            
            for (const [key, prompt] of Object.entries(prompts)) {
                try {
                    results[key] = await callAI(prompt, apiKey);
                } catch (error) {
                    console.error(`${key}生成エラー:`, error);
                    results[key] = `生成エラー: ${error.message}`;
                }
            }
            
            return {
                title: results.title,
                lyricsJP: results.lyricsJP,
                lyricsEN: results.lyricsEN,
                stylePrompt: results.stylePrompt,
                midjourneyPrompt: results.midjourneyPrompt,
                aspectRatio: "1:1",
                model: "v7"
            };
        }
        
        // AI API呼び出し
        async function callAI(prompt, apiKey) {
            let url, headers, body;
            
            switch (selectedAPI) {
                case 'openai':
                    url = 'https://api.openai.com/v1/chat/completions';
                    headers = {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    };
                    body = {
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 1000
                    };
                    break;
                    
                case 'claude':
                    url = 'https://api.anthropic.com/v1/messages';
                    headers = {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    };
                    body = {
                        model: 'claude-3-sonnet-20240229',
                        max_tokens: 1000,
                        messages: [{ role: 'user', content: prompt }]
                    };
                    break;
                    
                case 'gemini':
                    url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    body = {
                        contents: [{ parts: [{ text: prompt }] }]
                    };
                    break;
            }
            
            const response = await fetch(url, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            const data = await response.json();
            
            // レスポンス解析
            switch (selectedAPI) {
                case 'openai':
                    return data.choices[0].message.content;
                case 'claude':
                    return data.content[0].text;
                case 'gemini':
                    return data.candidates[0].content.parts[0].text;
            }
        }
        
        // 高度なローカル生成アルゴリズム
        function generateAdvancedTitle(theme) {
            const patterns = [
                `${theme.concept}`,
                `Digital ${randomWord(['Love', 'Dreams', 'Memories', 'Future'])}`,
                `${randomWord(['Cyber', 'Neo', 'Virtual', 'Quantum'])} ${theme.concept}`,
                `${theme.concept} ${randomWord(['Protocol', 'Syndrome', 'Algorithm', 'Paradox'])}`,
                `${randomWord(['Holographic', 'Binary', 'Electric', 'Neon'])} ${randomWord(['Heart', 'Soul', 'Mind', 'Dreams'])}`
            ];
            
            return patterns[Math.floor(Math.random() * patterns.length)];
        }
        
        function generateAdvancedJapaneseLyrics(theme) {
            const verses = [
                `データの海を漂って\n君の声を探してる\n${randomWord(['デジタル', 'バーチャル', 'サイバー'])}な世界で\n本物の愛を見つけた`,
                `${randomWord(['ピクセル', 'コード', 'アルゴリズム'])}に隠された想い\n${randomWord(['スクリーン', 'モニター', 'ディスプレイ'])}の向こうの君\n${randomWord(['リアル', '現実', '物理世界'])}を超えた絆\nこの気持ちは確かなもの`,
                `${randomWord(['量子', 'ナノ', 'フォトン'])}もつれた心\n${randomWord(['時空', '次元', '世界線'])}を越えて響く\n君への想いが止まらない\n永遠に続くこの愛を`
            ];
            
            const choruses = [
                `${theme.concept}が始まる\n${randomWord(['ネオン', 'レーザー', 'ホログラム'])}ライトが踊る夜に\n君と僕のストーリー\n${randomWord(['リアル', '現実', '真実'])}を超えた愛がある`,
                `${randomWord(['データストリーム', 'ネットワーク', 'クラウド'])}を駆け抜けて\n${randomWord(['同期', 'シンク', 'リンク'])}した心で\n${theme.concept}が続く\n永遠のループの中で`
            ];
            
            return `[Verse 1]\n${verses[0]}\n\n[Chorus]\n${choruses[0]}\n\n[Verse 2]\n${verses[1]}\n\n[Chorus]\n${choruses[1]}\n\n[Bridge]\n${verses[2]}\n\n[Final Chorus]\n${choruses[0]}`;
        }
        
        function generateAdvancedEnglishLyrics(theme) {
            const verses = [
                `In the ${randomWord(['digital', 'cyber', 'virtual'])} maze tonight\nPixels dancing in the ${randomWord(['neon', 'laser', 'holographic'])} light\n${randomWord(['Time', 'Space', 'Reality'])} bending through the cyber space\nYour ${randomWord(['holographic', 'digital', 'virtual'])} smile, I can't replace`,
                `Streaming data through my neural core\n${randomWord(['Love', 'Emotion', 'Feeling'])} uploading like never before\n${randomWord(['Virtual', 'Digital', 'Cyber'])} reality feels so real\nWhen you're the ${randomWord(['algorithm', 'program', 'code'])} I can feel`
            ];
            
            const choruses = [
                `${theme.concept} in the metaverse\nBreaking through the digital curse\nWe're glitching in and out of time\nYour love's the only perfect rhyme`,
                `${randomWord(['Quantum', 'Digital', 'Electric'])} hearts that beat as one\nIn this cyber world we run\n${theme.concept} never fades\nIn these ${randomWord(['electric', 'digital', 'cyber'])} serenades`
            ];
            
            return `[Verse 1]\n${verses[0]}\n\n[Chorus]\n${choruses[0]}\n\n[Verse 2]\n${verses[1]}\n\n[Chorus]\n${choruses[1]}\n\n[Bridge]\nSometimes the server crashes down\nBut we'll always come around\n${randomWord(['Backup', 'Save', 'Cache'])} saved in cloud nine\nForever you'll be mine\n\n[Final Chorus]\n${choruses[0]}`;
        }
        
        function generateAdvancedStylePrompt(theme) {
            const styles = ['Synthwave', 'Cyberpop', 'Future Bass', 'Electropop', 'Dream Pop', 'Vaporwave'];
            const moods = ['dreamy', 'melancholic', 'euphoric', 'nostalgic', 'futuristic', 'emotional'];
            const tempos = ['120-130 BPM', '110-120 BPM', '130-140 BPM', '100-110 BPM'];
            
            const style = randomWord(styles);
            const mood = randomWord(moods);
            const tempo = randomWord(tempos);
            
            return `Style: ${style} with ${randomWord(['ambient', 'atmospheric', 'ethereal'])} elements
Mood: ${mood} and emotionally engaging
Tempo: ${tempo}
Key: ${randomWord(['C Major', 'A Minor', 'G Major', 'F Major'])}
Instruments: ${randomWord(['Synthesizers', 'Digital piano', 'Electric guitar'])}, ${randomWord(['soft drums', 'electronic beats', '808 drums'])}, ${randomWord(['ethereal pads', 'ambient textures', 'vocal chops'])}
Vocal Style: ${randomWord(['Intimate', 'Dreamy', 'Emotional'])} with subtle ${randomWord(['autotune', 'reverb', 'delay'])}
Production: ${randomWord(['Clean mix', 'Lo-fi aesthetic', 'Polished production'])} with ${randomWord(['ambient reverb', 'spatial effects', 'stereo width'])}
Special Elements: ${randomWord(['Glitch effects', 'Vinyl crackle', 'Digital artifacts'])} during transitions, ${randomWord(['layered harmonies', 'vocal stacks', 'choir pads'])}
Theme: ${theme.concept}
Length: ~3 minutes`;
        }
        
        function generateAdvancedMidjourneyPrompt(theme) {
            const visualStyles = [
                'cyberpunk aesthetic with neon colors',
                'dreamy synthwave landscape',
                'futuristic city with holographic displays',
                'digital art style with glitch effects',
                'anime style cyberpunk romance',
                'vaporwave aesthetic with retro-futuristic elements'
            ];
            
            const colors = [
                'pink and blue neon',
                'purple and cyan gradients',
                'electric blue and magenta',
                'holographic rainbow colors',
                'warm orange and cool blue'
            ];
            
            const elements = [
                'floating geometric shapes',
                'digital rain effect',
                'holographic interfaces',
                'glowing circuit patterns',
                'particle effects'
            ];
            
            const style = randomWord(visualStyles);
            const color = randomWord(colors);
            const element = randomWord(elements);
            
            return `${style}, ${theme.concept} theme, ${color}, ${element}, romantic atmosphere, cinematic lighting, high detail, 4K quality, emotional composition, trending on artstation, digital art masterpiece`;
        }
        
        // ユーティリティ関数
        function randomWord(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
        
        // 結果表示
        function displayResults(generation) {
            const grid = document.getElementById('resultsGrid');
            const initialModel = generation.model === 'v7' ? 'v 7' : generation.model === 'niji6' ? 'niji 6' : 'v 7';
            
            grid.innerHTML = `
                <div class="result-card">
                    <div class="result-header">
                        🎵 楽曲タイトル
                        <button class="copy-btn" onclick="copyToClipboard('title')">📋 コピー</button>
                    </div>
                    <div class="result-content" id="titleContent">${generation.title}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        🎌 日本語歌詞
                        <button class="copy-btn" onclick="copyToClipboard('lyricsJP')">📋 コピー</button>
                    </div>
                    <div class="result-content" id="lyricsJPContent">${generation.lyricsJP}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        🇺🇸 英語歌詞
                        <button class="copy-btn" onclick="copyToClipboard('lyricsEN')">📋 コピー</button>
                    </div>
                    <div class="result-content" id="lyricsENContent">${generation.lyricsEN}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        🎨 Sunoスタイルプロンプト
                        <button class="copy-btn" onclick="copyToClipboard('stylePrompt')">📋 コピー</button>
                    </div>
                    <div class="result-content" id="stylePromptContent">${generation.stylePrompt}</div>
                </div>
                
                <div class="result-card full-width">
                    <div class="result-header">
                        🖼️ Midjourney画像プロンプト
                        <button class="copy-btn" onclick="copyToClipboard('midjourneyPrompt')">📋 コピー</button>
                    </div>
                    <div class="midjourney-controls">
                        <div class="control-group">
                            <label>比率:</label>
                            <select id="aspectRatio" onchange="updateMidjourneyPrompt()">
                                <option value="1:1">1:1 (正方形)</option>
                                <option value="9:16">9:16 (縦長)</option>
                                <option value="16:9">16:9 (横長)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>モデル:</label>
                            <select id="mjModel" onchange="updateMidjourneyPrompt()">
                                <option value="v7">v7</option>
                                <option value="niji6">niji6</option>
                            </select>
                        </div>
                    </div>
                    <div class="result-content" id="midjourneyPromptContent">${generation.midjourneyPrompt} --ar 1:1 --${initialModel}</div>
                </div>
            `;
        }
        
        // Midjourneyプロンプト更新
        function updateMidjourneyPrompt() {
            if (!currentGeneration) return;
            
            const aspectRatio = document.getElementById('aspectRatio').value;
            const model = document.getElementById('mjModel').value;
            const basePrompt = currentGeneration.midjourneyPrompt;
            
            const formattedModel = model === 'v7' ? 'v 7' : model === 'niji6' ? 'niji 6' : model;
            const updatedPrompt = `${basePrompt} --ar ${aspectRatio} --${formattedModel}`;
            document.getElementById('midjourneyPromptContent').textContent = updatedPrompt;
            
            currentGeneration.aspectRatio = aspectRatio;
            currentGeneration.model = model;
        }
        
        // クリップボードにコピー
        function copyToClipboard(type) {
            if (!currentGeneration) return;
            
            let text = '';
            switch(type) {
                case 'title':
                    text = currentGeneration.title;
                    break;
                case 'lyricsJP':
                    text = currentGeneration.lyricsJP;
                    break;
                case 'lyricsEN':
                    text = currentGeneration.lyricsEN;
                    break;
                case 'stylePrompt':
                    text = currentGeneration.stylePrompt;
                    break;
                case 'midjourneyPrompt':
                    const aspectRatio = document.getElementById('aspectRatio')?.value || '1:1';
                    const model = document.getElementById('mjModel')?.value || 'v7';
                    const formattedModel = model === 'v7' ? 'v 7' : model === 'niji6' ? 'niji 6' : model;
                    text = `${currentGeneration.midjourneyPrompt} --ar ${aspectRatio} --${formattedModel}`;
                    break;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showCopySuccess();
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopySuccess();
            });
        }
        
        function showCopySuccess() {
            const indicator = document.getElementById('savedIndicator');
            indicator.textContent = '📋 コピーしました！';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.textContent = '💾 自動保存されました';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        function showMessage(message, type = 'info') {
            const indicator = document.getElementById('savedIndicator');
            const icon = type === 'warning' ? '⚠️' : type === 'error' ? '❌' : 'ℹ️';
            indicator.textContent = `${icon} ${message}`;
            indicator.style.background = type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#28a745';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 4000);
        }
        
        function saveToHistory(generation) {
            let history = JSON.parse(localStorage.getItem('aiSunoHistory') || '[]');
            history.unshift(generation);
            history = history.slice(0, 10);
            localStorage.setItem('aiSunoHistory', JSON.stringify(history));
        }
        
        // ページ読み込み時の初期化
        window.addEventListener('load', () => {
            selectAPI('local');
        });
    </script>
</body>
</html>