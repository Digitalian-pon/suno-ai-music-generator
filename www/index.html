<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
        <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: https: 'unsafe-inline' 'unsafe-eval';">
        <title>Creative Prompt Studio</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                height: 100vh;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            }
            
            #loading {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                flex-direction: column;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
            
            .spinner {
                border: 4px solid #ffffff40;
                border-top: 4px solid #ffffff;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            #webframe {
                width: 100%;
                height: 100vh;
                border: none;
                display: none;
            }
            
            .error {
                color: #ff6b6b;
                text-align: center;
                padding: 20px;
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="loading">
            <div class="spinner"></div>
            <h3>Creative Prompt Studio</h3>
            <p>Loading application...</p>
        </div>
        
        <div class="error" id="error">
            <h3>接続エラー</h3>
            <p>インターネット接続を確認してください</p>
            <button onclick="reload()">再試行</button>
        </div>
        
        <iframe id="webframe" src="https://digitalian-pon.github.io/creative-prompt-studio/docs/"></iframe>
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript">
            let retryCount = 0;
            const maxRetries = 3;
            
            function onDeviceReady() {
                console.log('Running cordova-' + cordova.platformId + '@' + cordova.version);
                loadApp();
            }
            
            function loadApp() {
                const iframe = document.getElementById('webframe');
                const loading = document.getElementById('loading');
                const error = document.getElementById('error');
                
                iframe.onload = function() {
                    loading.style.display = 'none';
                    iframe.style.display = 'block';
                    error.style.display = 'none';
                };
                
                iframe.onerror = function() {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(loadApp, 2000);
                    } else {
                        loading.style.display = 'none';
                        error.style.display = 'block';
                    }
                };
                
                // Fallback timeout
                setTimeout(function() {
                    if (iframe.style.display === 'none') {
                        loading.style.display = 'none';
                        iframe.style.display = 'block';
                    }
                }, 10000);
            }
            
            function reload() {
                retryCount = 0;
                document.getElementById('error').style.display = 'none';
                document.getElementById('loading').style.display = 'flex';
                document.getElementById('webframe').style.display = 'none';
                loadApp();
            }
            
            document.addEventListener('deviceready', onDeviceReady, false);
        </script>
    </body>
</html>
